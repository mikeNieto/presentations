<br /><br /><br /><br /><br /><br /><br />
<h2><em>/* Release and Deploy */</em></h2>
<h2>
    Containers - Kubernetes - Helm - Jenkins(2/X)
</h2>

---
<h2>Containers</h2>

---
<h2>Containers</h2>
<h2><em>Docker</em></h2>

---
<h1>Docker</h1>
<img src="/images/containers/architecture-docker-components.png" />

---
<h1>Docker - Containers vs Virtual machines</h1>
<br /><br /><br />
<img src="/images/containers/containers-vs-vm.png" />
<style>
    img {
        height: 70%;
    }
</style>

---
<h1>Docker - Layers</h1>
<img src="/images/containers/container-layers.jpg" />
<br /><br />
<style>
    img {
        height: 80%;
    }
</style>

---

<h1>Containers</h1>
<h2>What is a <em>container</em>?</h2>

---

<h1>Container - Technical</h1>

<h3>Thin wrapper around Linux Container technology.</h3>
<h3>
    Leverages 4 functionalities from Linux to provide an isolated environment
</h3>
<div>
    <ul>
        <li>namespaces - visibility (pid)</li>
        <li>cgroups - control groups (resources)</li>
        <li>union filesystem - data</li>
        <li>seccomp - security profiles</li>
    </ul>
</div>
<style>
    div {
        margin-left: auto;
        margin-right: auto;
        display: table;
    }
    li {
        text-align: left;
    }
</style>

---
<h1>Containers - nameservers</h1>

<split-view>
    <div>
        <br /><br /><br />
        <h4><em>#Creating a isolated process#</em></h4>
        <h4>unshare --fork --pid --mount-proc bash</h4>
    </div>
    <web-term path="folder"></web-term>
</split-view>

---
<h1>Containers - cgroups (1)</h1>

<split-view>
    <div>
        <h4><em>#install cgroups libs#</em></h4>
        <h4>apt-get install libcgroup1 cgroup-tools</h4>
        <h4><em>#create an executable file#</em></h4>
        <h4>test.sh</h4>
    </div>

    <source-code folder="sources" files="test.sh" start-lines="" end-lines="">
    </source-code>
</split-view>
<style>
    h4:first-of-type {
        margin-top: 4vw;
    }
</style>
---
<h1>Containers - cgroups(2) - test.sh</h1>

<split-view>
    <div>
        <h4><em>#create a cgroup foo#</em></h4>
        <h4>cgcreate -g memory:foo</h4>
        <h4><em>#assign 50000 of memory#</em></h4>
        <h4>
            echo 50000 | tee /sys/fs/cgroup/memory/foo/memory.limit_in_bytes
        </h4>
        <h4><em>#check the allocation#</em></h4>
        <h4>cat /sys/fs/cgroup/memory/foo/memory.limit_in_bytes</h4>
        <h4><em>#execute the process#</em></h4>
        <h4>cgexec -g memory:foo ./test.sh</h4>
        <h4><em>#delete the cgroup</em></h4>
        <h4>cgdelete memory:foo</h4>
    </div>

    <web-term path="sources"></web-term>
</split-view>
---
<h1>Containers - Union File Systems (1)</h1>
<br /><br /><br /><br /><br /><br /><br /><br />
<img src="/images/containers/overlay_constructs.jpg" />

<style>
    img {
        height: 40%;
    }
</style>

---
<h1>Containers - Union File Systems (2)</h1>

<split-view>
    <div>
        <h4><em>#create 4 folders#</em></h4>
        <h4>mkdir base diff overlay workdir</h4>
        <h4><em>#create a base file#</em></h4>
        <h4>echo "this is my base layer" > base/file1</h4>
        <h4><em>#create the overlay (new layer)#</em></h4>
        <h4>
            mount -t overlay -o lowerdir=base,upperdir=diff,workdir=workdir none
            overlay
        </h4>
        <h4><em>#Umount the overlay#</em></h4>
        <h4>sudo umount overlay</h4>
        <h4><em>#remoe all#</em></h4>
        <h4>rm -Rf base diff overlay workdir</h4>
    </div>

    <web-term path="/ufiles"></web-term>
</split-view>
---
<div>
    <img src="/images/k8s/Kubernetes_logo.png" />
</div>
<style>
    img {
        margin-top: 10em;
        width: 60%;
        height: 60%;
    }
</style>
---
<h1>History</h1>
<img src="/images/k8s/borg-cgroups.png" />

---
<h1>Whole datacenter as a single deployment platform</h1>

<img id="img" src="/images/k8s/single-deployment.jpg" />
<style>
    #img {
        margin-top: 5em;
        width: 80%;
        height: 65%;
    }
</style>

---
<h1>Components</h1>

<img id="img" src="/images/k8s/k8s-components.jpg" />
<style>
    #img {
        margin-top: 5em;
        width: 80%;
        height: 65%;
    }
</style>

---
<h1>Basic overview</h1>

<img id="img" src="/images/k8s/basic-overview.jpg" />
<style>
    #img {
        margin-top: 2em;
        width: 75%;
        height: 75%;
    }
</style>

---
<h1>Cloud Providers</h1>

<img id="img" src="/images/k8s/cloud-providers.png" />
<style>
    #img {
        background-color: white;
        margin-top: 2em;
        width: 75%;
        height: 75%;
    }
</style>

---

<h1>or Minikube</h1>

<h3>
    curl -Lo minikube
    https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
    && chmod +x minikube
</h3>
<br /><br /><br />
<h3>
    sudo cp minikube /usr/local/bin && rm minikube
</h3>

---

<h1>Starting minikube locally -> "minikube start --vm-driver=none"</h1>
<split-view>
    <web-term path=""></web-term>
</split-view>

---

<h1>Minikube dashboard -> "kubectl proxy"</h1>

<split-view>
    <web-term path=""></web-term>
    <web-browser
        src="http://127.0.0.1:8001/api/v1/namespaces/kube-system/services/http:kubernetes-dashboard:/proxy/"
    ></web-browser>
</split-view>

---
<h1>Pod</h1>

<img id="img" src="/images/k8s/pods.png" />
<style>
    #img {
        margin-top: 2em;
        width: 85%;
        height: 70%;
    }
</style>
---
<h1>Pod in practice</h1>
<split-view>
    <source-code
        folder="k8s"
        files="app.js Dockerfile pod.yaml"
        start-lines=";;2,7"
        end-lines=";;2,8"
    ></source-code>
</split-view>
---
<h1>Running that pod (kubectl create -f "object")</h1>
<split-view>
    <source-code
        folder="k8s"
        files="pod.yaml"
        start-lines=""
        end-lines=""
    ></source-code>
    <web-term path="k8s"></web-term>
</split-view>
---
<h1>ReplicaSet</h1>

<img id="img" src="/images/k8s/replicaset.png" />
<style>
    #img {
        margin-top: 2em;
        width: 85%;
        height: 70%;
    }
</style>
---
<h1>ReplicaSet (2)</h1>
<split-view>
    <source-code
        folder="k8s"
        files="replicaset.yaml"
        start-lines="2,15"
        end-lines="2,17"
    ></source-code>
    <web-term path="k8s"></web-term>
</split-view>
---
<h1>ReplicaSet (3) - Pods recreation</h1>
<split-view>
    <web-term path="k8s"></web-term>
</split-view>
---
<h1>ReplicaSet (4) - Scaling (kubectl scale rs "object" --replicas X)</h1>
<split-view>
    <web-term path="k8s"></web-term>
</split-view>

---
<h1>Services</h1>

<img id="img" src="/images/k8s/services.jpg" />
<style>
    #img {
        margin-top: 1em;
        width: 70%;
        height: 70%;
    }
</style>
---
<h1>Service (2)</h1>
<split-view>
    <source-code
        folder="k8s"
        files="service.yaml"
        start-lines="2,9"
        end-lines="2,10"
    ></source-code>
    <web-term path="k8s"></web-term>
</split-view>
---
<h1>Service (3) - Endpoints</h1>
<split-view>
    <web-term path="k8s"></web-term>
</split-view>
---
<h1>Service (4) - Discovering services</h1>
<split-view>
    <div>
        <h4><em>#Create a busybox pod#</em></h4>
        <h4>
            kubectl run test-app --image=radial/busyboxplus:curl -i --tty --rm
        </h4>
    </div>
    <web-term path="k8s"></web-term>
</split-view>
---
<h1>Services (5) - Load Balancer</h1>
<img id="img" src="/images/k8s/load-balancer.jpg" />
<style>
    #img {
        margin-top: 1em;
        width: 70%;
        height: 70%;
    }
</style>

---
<h1>Services (6) - Load Balancer yaml</h1>
<split-view>
    <source-code
        folder="k8s"
        files="service.yaml"
        start-lines=""
        end-lines=""
    ></source-code>
    <source-code
        folder="k8s"
        files="load-balancer.yaml"
        start-lines="6"
        end-lines="6"
    ></source-code>
</split-view>
---
<h1>Services (7) - NodePort</h1>
<img id="img" src="/images/k8s/nodePort.jpg" />
<style>
    #img {
        margin-top: 1em;
        width: 70%;
        height: 70%;
    }
</style>
---
<h1>Services (8) - Ingress</h1>
<img id="img" src="/images/k8s/ingress.jpg" />
<style>
    #img {
        margin-top: 1em;
        width: 80%;
        height: 70%;
    }
</style>
---
<h1>Services (9) - Ingress yaml</h1>
<split-view>
    <source-code
        folder="k8s"
        files="ingress.yaml"
        start-lines="7,12"
        end-lines="7,13"
    ></source-code>
</split-view>
---
<h1>Deployments</h1>

<img id="img" src="/images/k8s/deployments.png" />
<style>
    #img {
        margin-top: 1em;
        width: 50%;
        height: 70%;
    }
</style>
---
<h1>Deployments (2) - Updating aplications</h1>
<h4>Update ReplicaSet template and deleting old Pods</h4>
<img id="img" src="/images/k8s/update-changing-rs-image.jpg" />
<style>
    #img {
        margin-top: 1em;
        width: 70%;
        height: 70%;
    }
</style>
---
<h1>Deployments (3) - Updating aplications</h1>
<h4>Blue-Green deployment</h4>
<img id="img" src="/images/k8s/blue-green.jpg" />
<style>
    #img {
        margin-top: 1em;
        width: 70%;
        height: 70%;
    }
</style>
---
<h1>Deployments (4) - Updating aplications</h1>
<h4>Rolling update (Zero downtime)</h4>
<img id="img" src="/images/k8s/rolling-update.jpg" />
<style>
    #img {
        margin-top: 1em;
        width: 70%;
        height: 70%;
    }
</style>

---
<h1>Deployments (5) - yaml</h1>
<split-view>
    <img id="img" src="/images/k8s/deployment-single.jpg" />
    <source-code
        folder="k8s"
        files="deployment.yaml service.yaml"
        start-lines="2,14;7"
        end-lines="2,15;8"
    ></source-code>
</split-view>
<style>
    #img {
        margin-top: 12em;
        margin-left: 1em;
        width: 90%;
        height: 20%;
    }
</style>
---
<h1>Deployments (6) - yaml</h1>
<split-view>
    <div>
        <h4><em>#creating the deployment#</em></h4>
        <h4>kubectl create -f deployment.yaml --record</h4>
        <img id="img" src="/images/k8s/deployment-single.jpg" />
        <br /><br /><br />
        <h4><em>#Checking the status#</em></h4>
        <h4>kubectl rollout status deployment front</h4>
    </div>
    <web-term path="k8s"></web-term>
</split-view>
<style>
    h4:first-of-type {
        margin-top: 4em;
    }
</style>
---
<h1>
    Deployments (7) - update to new version (kubectl apply -f deployment.yaml)
</h1>
<split-view>
    <web-term path="k8s"></web-term>
</split-view>
---
<h1>
    Deployments (8)
</h1>
<split-view>
    <div>
        <h4><em>#history#</em></h4>
        <h4>kubectl rollout history deployment front</h4>
        <h4><em>#rollback#</em></h4>
        <h4>kubectl rollout undo deployment front</h4>
        <h4><em>#rollback to revision#</em></h4>
        <h4>kubectl rollout undo deployment front --to-revision=1</h4>
    </div>
    <web-term path="k8s"></web-term>
</split-view>
<style>
    h4:first-of-type {
        margin-top: 4em;
    }
</style>
---
<h1>
    Deployments (9)
</h1>
<img id="img" src="/images/k8s/rs-revisions.jpg" />
<style>
    #img {
        margin-top: 12em;
        margin-left: 1em;
        width: 90%;
        height: 40%;
    }
</style>
---
<div>
    <img src="/images/helm/helm-logo.png" />
</div>
<style>
    img {
        margin-top: 5em;
        width: 40%;
        height: 40%;
    }
</style>

--- ---
<h1>Snapshot</h1>

<img src="/images/bazel.png" />
<img id="qr" src="/qrcode?url=https://bazel.build/" />

---

<h1>Terminal</h1>

<split-view>
    <web-term path="folder"></web-term>
</split-view>

---

<h1>
    Shell &amp; Browser -
    <strong>Type `python -m SimpleHTTPServer` in the shell window</strong>
</h1>

<split-view>
    <web-term path="folder"></web-term>
    <web-browser src="http://"></web-browser>
</split-view>

---
<h1>
    Browser
</h1>

<split-view>
    <web-browser
        src="http://10.101.93.128:8080/job/CICD-backendApp/"
    ></web-browser>
</split-view>

---
<script src="/js/draw.js"></script>
<h1>Code samples</h1>

<split-view>
    <web-term path="folder"></web-term>
    <source-code
        folder="sources"
        files="main.go pod.yaml"
        start-lines="26;18,21"
        end-lines="27;18,22"
    >
    </source-code>
</split-view>

---

<h1>Draw on slides</h1>

<p>
    On the left border of the page there's a pen that can be used to draw on the
    slides. Type <em>&lt;ESC&gt;</em> to exit draw mode.
</p>

<img src="/images/bazel.png" />
<script src="/js/draw.js"></script>

<style>
    img {
        height: 75%;
    }
</style>
